services:
  tududi:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tududi
    environment:
      - TUDUDI_USER_EMAIL=${TUDUDI_USER_EMAIL:-admin@example.com}
      - TUDUDI_USER_PASSWORD=${TUDUDI_USER_PASSWORD:-your-secure-password}
      - TUDUDI_SESSION_SECRET=${TUDUDI_SESSION_SECRET:-changeme-please-use-openssl}
      - TUDUDI_ALLOWED_ORIGINS=${TUDUDI_ALLOWED_ORIGINS:-http://localhost:3002}
      - TUDUDI_TRUST_PROXY=${TUDUDI_TRUST_PROXY:-false}
      - TUDUDI_UPLOAD_PATH=${TUDUDI_UPLOAD_PATH:-/app/backend/uploads}
      # Feature Flags
      - FF_ENABLE_BACKUPS=${FF_ENABLE_BACKUPS:-false}
      - FF_ENABLE_CALENDAR=${FF_ENABLE_CALENDAR:-false}
      - FF_ENABLE_HABITS=${FF_ENABLE_HABITS:-false}
      - FF_ENABLE_TELEGRAM=${FF_ENABLE_TELEGRAM:-false}
      - FF_ENABLE_SCHEDULER=${FF_ENABLE_SCHEDULER:-false}
      # Other environment variables
      - BACKEND_URL=${BACKEND_URL:-http://localhost:3002}
      - SWAGGER_ENABLED=${SWAGGER_ENABLED:-false}
      # Push Notifications (optional) - generate with: npm run vapid:generate
      - VAPID_SUBJECT=${VAPID_SUBJECT:-mailto:admin@example.com}
      - VAPID_PUBLIC_KEY=${VAPID_PUBLIC_KEY:-changeme-please-use-openssl}
      - VAPID_PRIVATE_KEY=${VAPID_PRIVATE_KEY:-changeme-please-use-openssl}
      # Runtime UID/GID configuration - set these to match your host user/group
      - PUID=${PUID:-1001}
      - PGID=${PGID:-1001}
    volumes:
      - ./tududi_db:/app/backend/db
      - ./uploads:/app/backend/uploads
    ports:
      - "3002:3002"
    restart: unless-stopped
